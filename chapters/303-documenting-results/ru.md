# –î–µ–Ω—å 303: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞

–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—Ä–µ–π–¥–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –¥–µ—Å—è—Ç–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –ø–æ–ª—É—á–∏–ª —Å–æ—Ç–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –Ω–æ –Ω–µ –∑–∞–ø–∏—Å–∞–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ. –ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü –æ–Ω –Ω–µ –ø–æ–º–Ω–∏—Ç:
- –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞–≤–∞–ª–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?
- –ù–∞ –∫–∞–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞?
- –ö–∞–∫–∏–µ –±—ã–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å–∞–¥–∫–∏?
- –ü–æ—á–µ–º—É –æ–¥–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±—ã–ª–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞?

–≠—Ç–æ –∫–∞–∫ –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫ —Å–¥–µ–ª–æ–∫, –Ω–æ –∑–∞–±—ã–≤–∞—Ç—å –≤ –Ω–µ–≥–æ –ø–∏—Å–∞—Ç—å. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ‚Äî –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏ –∑–Ω–∞–Ω–∏—è.

**–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤ –∞–ª–≥–æ—Ç—Ä–µ–π–¥–∏–Ω–≥–µ ‚Äî —ç—Ç–æ:
- –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –±—ç–∫—Ç–µ—Å—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
- –ê–Ω–∞–ª–∏–∑ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–µ—à–µ–Ω–∏–π

–ö–∞–∫ –Ω–∞—É—á–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: –±–µ–∑ –∑–∞–ø–∏—Å–µ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.

## –ó–∞—á–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞?

–í –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º –∞–ª–≥–æ—Ç—Ä–µ–π–¥–∏–Ω–≥–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ –æ–ø—Ü–∏—è, –∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:

| –ü—Ä–∏—á–∏–Ω–∞ | –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ | –ü—Ä–∏–º–µ—Ä |
|---------|-----------------|--------|
| **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å** | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü | –ó–∞–ø–∏—Å–∞–ª–∏ seed RNG –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** | –í—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é –∏–∑ 10 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π | –¢–∞–±–ª–∏—Ü–∞ —Å Sharpe ratio –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ |
| **–ê—É–¥–∏—Ç** | –û–±—ä—è—Å–Ω–∏—Ç—å —Ä–µ–≥—É–ª—è—Ç–æ—Ä—É –∏–ª–∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä—É | –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ |
| **–û–±—É—á–µ–Ω–∏–µ** | –ü–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å | –õ–æ–≥–∏ –ø–æ–∫–∞–∑–∞–ª–∏ look-ahead bias |
| **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | –û—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ | Git commit hash –≤ –∫–∞–∂–¥–æ–º –æ—Ç—á—ë—Ç–µ |

## –ß—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å?

### 1. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞

```rust
use chrono::{DateTime, Utc};
use serde::{Serialize, Deserialize};

#[derive(Debug, Serialize, Deserialize)]
struct BacktestMetadata {
    /// –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ—Å—Ç–∞
    test_id: String,
    /// –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    strategy_name: String,
    /// –í–µ—Ä—Å–∏—è –∫–æ–¥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (git commit)
    code_version: String,
    /// –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
    timestamp: DateTime<Utc>,
    /// –ö—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª —Ç–µ—Å—Ç
    author: String,
    /// –û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ —Ç–µ—Å—Ç–∞
    description: String,
}

impl BacktestMetadata {
    fn new(strategy_name: &str, description: &str) -> Self {
        Self {
            test_id: uuid::Uuid::new_v4().to_string(),
            strategy_name: strategy_name.to_string(),
            code_version: "abc123def".to_string(), // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏: git rev-parse HEAD
            timestamp: Utc::now(),
            author: "trading-bot".to_string(),
            description: description.to_string(),
        }
    }

    fn print(&self) {
        println!("=== –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±—ç–∫—Ç–µ—Å—Ç–∞ ===");
        println!("ID: {}", self.test_id);
        println!("–°—Ç—Ä–∞—Ç–µ–≥–∏—è: {}", self.strategy_name);
        println!("–í–µ—Ä—Å–∏—è –∫–æ–¥–∞: {}", self.code_version);
        println!("–í—Ä–µ–º—è: {}", self.timestamp.format("%Y-%m-%d %H:%M:%S UTC"));
        println!("–ê–≤—Ç–æ—Ä: {}", self.author);
        println!("–û–ø–∏—Å–∞–Ω–∏–µ: {}", self.description);
    }
}

fn main() {
    let metadata = BacktestMetadata::new(
        "MA Crossover v2.1",
        "–¢–µ—Å—Ç —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞"
    );
    metadata.print();
}
```

### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```rust
#[derive(Debug, Serialize, Deserialize, Clone)]
struct StrategyParameters {
    /// –ü–µ—Ä–∏–æ–¥ –∫–æ—Ä–æ—Ç–∫–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π
    ma_short_period: usize,
    /// –ü–µ—Ä–∏–æ–¥ –¥–ª–∏–Ω–Ω–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π
    ma_long_period: usize,
    /// –°—Ç–æ–ø-–ª–æ—Å—Å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    stop_loss_pct: f64,
    /// –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    take_profit_pct: f64,
    /// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞)
    max_position_size: f64,
}

impl StrategyParameters {
    fn to_json(&self) -> String {
        serde_json::to_string_pretty(self).unwrap()
    }

    fn print(&self) {
        println!("\n=== –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ===");
        println!("MA Short: {}", self.ma_short_period);
        println!("MA Long: {}", self.ma_long_period);
        println!("Stop Loss: {:.2}%", self.stop_loss_pct * 100.0);
        println!("Take Profit: {:.2}%", self.take_profit_pct * 100.0);
        println!("Max Position Size: {:.2}%", self.max_position_size * 100.0);
    }
}

fn main() {
    let params = StrategyParameters {
        ma_short_period: 10,
        ma_long_period: 50,
        stop_loss_pct: 0.02,
        take_profit_pct: 0.05,
        max_position_size: 0.10,
    };

    params.print();
    println!("\nJSON representation:");
    println!("{}", params.to_json());
}
```

### 3. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```rust
#[derive(Debug, Serialize, Deserialize)]
struct PerformanceMetrics {
    /// –û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
    total_return: f64,
    /// Annualized return
    annual_return: f64,
    /// Sharpe ratio
    sharpe_ratio: f64,
    /// Maximum drawdown
    max_drawdown: f64,
    /// Win rate (–ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫)
    win_rate: f64,
    /// Profit factor
    profit_factor: f64,
    /// –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫
    total_trades: usize,
    /// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
    winning_trades: usize,
    /// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
    losing_trades: usize,
    /// –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å –Ω–∞ —Å–¥–µ–ª–∫—É
    avg_profit_per_trade: f64,
    /// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å
    max_profit: f64,
    /// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–±—ã—Ç–æ–∫
    max_loss: f64,
}

impl PerformanceMetrics {
    fn print(&self) {
        println!("\n=== –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ===");
        println!("–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {:.2}%", self.total_return * 100.0);
        println!("–ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {:.2}%", self.annual_return * 100.0);
        println!("Sharpe Ratio: {:.2}", self.sharpe_ratio);
        println!("Max Drawdown: {:.2}%", self.max_drawdown * 100.0);
        println!("Win Rate: {:.2}%", self.win_rate * 100.0);
        println!("Profit Factor: {:.2}", self.profit_factor);
        println!("\n=== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–¥–µ–ª–æ–∫ ===");
        println!("–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: {}", self.total_trades);
        println!("–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: {}", self.winning_trades);
        println!("–£–±—ã—Ç–æ—á–Ω—ã—Ö: {}", self.losing_trades);
        println!("–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: {:.2}%", self.avg_profit_per_trade * 100.0);
        println!("–ú–∞–∫—Å. –ø—Ä–∏–±—ã–ª—å: {:.2}%", self.max_profit * 100.0);
        println!("–ú–∞–∫—Å. —É–±—ã—Ç–æ–∫: {:.2}%", self.max_loss * 100.0);
    }

    fn grade(&self) -> &str {
        if self.sharpe_ratio > 2.0 && self.max_drawdown.abs() < 0.15 {
            "–û—Ç–ª–∏—á–Ω–æ ‚úÖ"
        } else if self.sharpe_ratio > 1.0 && self.max_drawdown.abs() < 0.25 {
            "–•–æ—Ä–æ—à–æ üëç"
        } else if self.sharpe_ratio > 0.5 {
            "–ü—Ä–∏–µ–º–ª–µ–º–æ ‚ö†Ô∏è"
        } else {
            "–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ ‚ùå"
        }
    }
}

fn main() {
    let metrics = PerformanceMetrics {
        total_return: 0.45,
        annual_return: 0.18,
        sharpe_ratio: 1.6,
        max_drawdown: -0.12,
        win_rate: 0.58,
        profit_factor: 1.8,
        total_trades: 150,
        winning_trades: 87,
        losing_trades: 63,
        avg_profit_per_trade: 0.003,
        max_profit: 0.08,
        max_loss: -0.05,
    };

    metrics.print();
    println!("\n–û—Ü–µ–Ω–∫–∞: {}", metrics.grade());
}
```

## –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –æ –±—ç–∫—Ç–µ—Å—Ç–µ

```rust
#[derive(Debug, Serialize, Deserialize)]
struct Trade {
    entry_time: String,
    exit_time: String,
    symbol: String,
    side: String,  // "LONG" –∏–ª–∏ "SHORT"
    entry_price: f64,
    exit_price: f64,
    quantity: f64,
    pnl: f64,
    pnl_pct: f64,
}

#[derive(Debug, Serialize, Deserialize)]
struct BacktestReport {
    metadata: BacktestMetadata,
    parameters: StrategyParameters,
    metrics: PerformanceMetrics,
    trades: Vec<Trade>,
    equity_curve: Vec<f64>,  // –≠–∫–≤–∏—Ç–∏ –ø–æ –¥–Ω—è–º
}

impl BacktestReport {
    fn new(
        metadata: BacktestMetadata,
        parameters: StrategyParameters,
        metrics: PerformanceMetrics,
        trades: Vec<Trade>,
        equity_curve: Vec<f64>,
    ) -> Self {
        Self {
            metadata,
            parameters,
            metrics,
            trades,
            equity_curve,
        }
    }

    /// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç –≤ JSON —Ñ–∞–π–ª
    fn save_to_file(&self, filename: &str) -> std::io::Result<()> {
        let json = serde_json::to_string_pretty(self).unwrap();
        std::fs::write(filename, json)?;
        println!("‚úÖ –û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: {}", filename);
        Ok(())
    }

    /// –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç—á—ë—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞
    fn load_from_file(filename: &str) -> std::io::Result<Self> {
        let json = std::fs::read_to_string(filename)?;
        let report: BacktestReport = serde_json::from_str(&json)
            .map_err(|e| std::io::Error::new(std::io::ErrorKind::InvalidData, e))?;
        Ok(report)
    }

    /// –°–æ–∑–¥–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç
    fn generate_text_report(&self) -> String {
        let mut report = String::new();

        report.push_str("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
        report.push_str("           –û–¢–ß–Å–¢ –û –ë–≠–ö–¢–ï–°–¢–ò–ù–ì–ï –°–¢–†–ê–¢–ï–ì–ò–ò\n");
        report.push_str("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n");

        // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
        report.push_str(&format!("ID —Ç–µ—Å—Ç–∞: {}\n", self.metadata.test_id));
        report.push_str(&format!("–°—Ç—Ä–∞—Ç–µ–≥–∏—è: {}\n", self.metadata.strategy_name));
        report.push_str(&format!("–í–µ—Ä—Å–∏—è –∫–æ–¥–∞: {}\n", self.metadata.code_version));
        report.push_str(&format!("–î–∞—Ç–∞: {}\n", self.metadata.timestamp.format("%Y-%m-%d %H:%M:%S")));
        report.push_str(&format!("–û–ø–∏—Å–∞–Ω–∏–µ: {}\n\n", self.metadata.description));

        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
        report.push_str("‚îÄ‚îÄ‚îÄ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚îÄ‚îÄ‚îÄ\n");
        report.push_str(&format!("MA Short: {}\n", self.parameters.ma_short_period));
        report.push_str(&format!("MA Long: {}\n", self.parameters.ma_long_period));
        report.push_str(&format!("Stop Loss: {:.2}%\n", self.parameters.stop_loss_pct * 100.0));
        report.push_str(&format!("Take Profit: {:.2}%\n\n", self.parameters.take_profit_pct * 100.0));

        // –ú–µ—Ç—Ä–∏–∫–∏
        report.push_str("‚îÄ‚îÄ‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚îÄ‚îÄ‚îÄ\n");
        report.push_str(&format!("–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {:.2}%\n", self.metrics.total_return * 100.0));
        report.push_str(&format!("Sharpe Ratio: {:.2}\n", self.metrics.sharpe_ratio));
        report.push_str(&format!("Max Drawdown: {:.2}%\n", self.metrics.max_drawdown * 100.0));
        report.push_str(&format!("Win Rate: {:.2}%\n", self.metrics.win_rate * 100.0));
        report.push_str(&format!("–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: {}\n", self.metrics.total_trades));
        report.push_str(&format!("–û—Ü–µ–Ω–∫–∞: {}\n\n", self.metrics.grade()));

        report.push_str("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");

        report
    }

    fn print_summary(&self) {
        println!("{}", self.generate_text_report());
    }
}

fn main() {
    // –°–æ–∑–¥–∞—ë–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π –æ—Ç—á—ë—Ç
    let metadata = BacktestMetadata::new(
        "MA Crossover v2.1",
        "–¢–µ—Å—Ç –Ω–∞ BTC/USDT —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"
    );

    let parameters = StrategyParameters {
        ma_short_period: 10,
        ma_long_period: 50,
        stop_loss_pct: 0.02,
        take_profit_pct: 0.05,
        max_position_size: 0.10,
    };

    let metrics = PerformanceMetrics {
        total_return: 0.45,
        annual_return: 0.18,
        sharpe_ratio: 1.6,
        max_drawdown: -0.12,
        win_rate: 0.58,
        profit_factor: 1.8,
        total_trades: 150,
        winning_trades: 87,
        losing_trades: 63,
        avg_profit_per_trade: 0.003,
        max_profit: 0.08,
        max_loss: -0.05,
    };

    let trades = vec![
        Trade {
            entry_time: "2024-01-15 10:30:00".to_string(),
            exit_time: "2024-01-15 14:20:00".to_string(),
            symbol: "BTC/USDT".to_string(),
            side: "LONG".to_string(),
            entry_price: 42000.0,
            exit_price: 43500.0,
            quantity: 0.1,
            pnl: 150.0,
            pnl_pct: 0.0357,
        },
        // ... –±–æ–ª—å—à–µ —Å–¥–µ–ª–æ–∫
    ];

    let equity_curve = vec![10000.0, 10150.0, 10300.0, 10250.0, 10500.0];

    let report = BacktestReport::new(metadata, parameters, metrics, trades, equity_curve);

    // –ü–µ—á–∞—Ç–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç
    report.print_summary();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
    let filename = format!("backtest_report_{}.json", report.metadata.test_id);
    report.save_to_file(&filename).unwrap();
}
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```rust
use std::fs;
use std::path::Path;

struct BacktestDatabase {
    storage_path: String,
}

impl BacktestDatabase {
    fn new(storage_path: &str) -> Self {
        // –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        fs::create_dir_all(storage_path).ok();
        Self {
            storage_path: storage_path.to_string(),
        }
    }

    /// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç –≤ –±–∞–∑—É
    fn save_report(&self, report: &BacktestReport) -> std::io::Result<String> {
        let filename = format!(
            "{}/{}_{}_{}.json",
            self.storage_path,
            report.metadata.timestamp.format("%Y%m%d_%H%M%S"),
            report.metadata.strategy_name.replace(" ", "_"),
            &report.metadata.test_id[..8]
        );

        report.save_to_file(&filename)?;
        Ok(filename)
    }

    /// –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –æ—Ç—á—ë—Ç—ã
    fn load_all_reports(&self) -> Vec<BacktestReport> {
        let mut reports = Vec::new();

        if let Ok(entries) = fs::read_dir(&self.storage_path) {
            for entry in entries.flatten() {
                if let Some(ext) = entry.path().extension() {
                    if ext == "json" {
                        if let Ok(report) = BacktestReport::load_from_file(
                            entry.path().to_str().unwrap()
                        ) {
                            reports.push(report);
                        }
                    }
                }
            }
        }

        reports
    }

    /// –ù–∞–π—Ç–∏ –ª—É—á—à–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ Sharpe ratio
    fn find_best_strategies(&self, top_n: usize) -> Vec<BacktestReport> {
        let mut reports = self.load_all_reports();
        reports.sort_by(|a, b| {
            b.metrics.sharpe_ratio
                .partial_cmp(&a.metrics.sharpe_ratio)
                .unwrap()
        });
        reports.truncate(top_n);
        reports
    }

    /// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç–µ—Å—Ç–∞–º
    fn print_statistics(&self) {
        let reports = self.load_all_reports();

        println!("=== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±—ç–∫—Ç–µ—Å—Ç–æ–≤ ===");
        println!("–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {}", reports.len());

        if reports.is_empty() {
            return;
        }

        let avg_sharpe: f64 = reports.iter()
            .map(|r| r.metrics.sharpe_ratio)
            .sum::<f64>() / reports.len() as f64;

        let avg_return: f64 = reports.iter()
            .map(|r| r.metrics.total_return)
            .sum::<f64>() / reports.len() as f64;

        println!("–°—Ä–µ–¥–Ω–∏–π Sharpe: {:.2}", avg_sharpe);
        println!("–°—Ä–µ–¥–Ω—è—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {:.2}%", avg_return * 100.0);

        println!("\n–¢–æ–ø-3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ Sharpe:");
        for (i, report) in self.find_best_strategies(3).iter().enumerate() {
            println!("  {}. {} - Sharpe: {:.2}",
                i + 1,
                report.metadata.strategy_name,
                report.metrics.sharpe_ratio
            );
        }
    }
}

fn main() {
    let db = BacktestDatabase::new("./backtest_results");

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç—á—ë—Ç–æ–≤ (–ø—Ä–∏–º–µ—Ä—ã)
    println!("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ—Ç—á—ë—Ç–æ–≤...\n");

    // ... —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    db.print_statistics();
}
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown –æ—Ç—á—ë—Ç–æ–≤

```rust
impl BacktestReport {
    /// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown –æ—Ç—á—ë—Ç–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    fn generate_markdown_report(&self) -> String {
        let mut md = String::new();

        md.push_str(&format!("# Backtest Report: {}\n\n", self.metadata.strategy_name));

        md.push_str("## Metadata\n\n");
        md.push_str(&format!("- **Test ID**: `{}`\n", self.metadata.test_id));
        md.push_str(&format!("- **Strategy**: {}\n", self.metadata.strategy_name));
        md.push_str(&format!("- **Code Version**: `{}`\n", self.metadata.code_version));
        md.push_str(&format!("- **Date**: {}\n", self.metadata.timestamp.format("%Y-%m-%d %H:%M:%S UTC")));
        md.push_str(&format!("- **Author**: {}\n", self.metadata.author));
        md.push_str(&format!("- **Description**: {}\n\n", self.metadata.description));

        md.push_str("## Strategy Parameters\n\n");
        md.push_str("```json\n");
        md.push_str(&self.parameters.to_json());
        md.push_str("\n```\n\n");

        md.push_str("## Performance Metrics\n\n");
        md.push_str("| Metric | Value |\n");
        md.push_str("|--------|-------|\n");
        md.push_str(&format!("| Total Return | {:.2}% |\n", self.metrics.total_return * 100.0));
        md.push_str(&format!("| Annual Return | {:.2}% |\n", self.metrics.annual_return * 100.0));
        md.push_str(&format!("| Sharpe Ratio | {:.2} |\n", self.metrics.sharpe_ratio));
        md.push_str(&format!("| Max Drawdown | {:.2}% |\n", self.metrics.max_drawdown * 100.0));
        md.push_str(&format!("| Win Rate | {:.2}% |\n", self.metrics.win_rate * 100.0));
        md.push_str(&format!("| Profit Factor | {:.2} |\n", self.metrics.profit_factor));
        md.push_str(&format!("| Total Trades | {} |\n", self.metrics.total_trades));
        md.push_str(&format!("| Winning Trades | {} |\n", self.metrics.winning_trades));
        md.push_str(&format!("| Losing Trades | {} |\n\n", self.metrics.losing_trades));

        md.push_str(&format!("**Grade**: {}\n\n", self.metrics.grade()));

        md.push_str("## Trade Summary\n\n");
        md.push_str(&format!("Total trades: {}\n\n", self.trades.len()));

        if !self.trades.is_empty() {
            md.push_str("### First 5 Trades\n\n");
            md.push_str("| Entry Time | Symbol | Side | Entry Price | Exit Price | P&L % |\n");
            md.push_str("|------------|--------|------|-------------|------------|-------|\n");

            for trade in self.trades.iter().take(5) {
                md.push_str(&format!(
                    "| {} | {} | {} | {:.2} | {:.2} | {:.2}% |\n",
                    trade.entry_time,
                    trade.symbol,
                    trade.side,
                    trade.entry_price,
                    trade.exit_price,
                    trade.pnl_pct * 100.0
                ));
            }
            md.push_str("\n");
        }

        md
    }

    fn save_markdown_report(&self, filename: &str) -> std::io::Result<()> {
        let markdown = self.generate_markdown_report();
        std::fs::write(filename, markdown)?;
        println!("‚úÖ Markdown –æ—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {}", filename);
        Ok(())
    }
}

fn main() {
    // ... —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞

    let report = BacktestReport::new(
        BacktestMetadata::new("MA Crossover", "Test description"),
        StrategyParameters {
            ma_short_period: 10,
            ma_long_period: 50,
            stop_loss_pct: 0.02,
            take_profit_pct: 0.05,
            max_position_size: 0.10,
        },
        PerformanceMetrics {
            total_return: 0.45,
            annual_return: 0.18,
            sharpe_ratio: 1.6,
            max_drawdown: -0.12,
            win_rate: 0.58,
            profit_factor: 1.8,
            total_trades: 150,
            winning_trades: 87,
            losing_trades: 63,
            avg_profit_per_trade: 0.003,
            max_profit: 0.08,
            max_loss: -0.05,
        },
        vec![],
        vec![],
    );

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º Markdown –æ—Ç—á—ë—Ç
    report.save_markdown_report("backtest_report.md").unwrap();
}
```

## –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏

| –ö–æ–Ω—Ü–µ–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** | ID —Ç–µ—Å—Ç–∞, –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞, –≤—Ä–µ–º—è, –∞–≤—Ç–æ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ |
| **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã** | –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ |
| **–ú–µ—Ç—Ä–∏–∫–∏** | Sharpe, –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å–∞–¥–∫–∞, win rate –∏ –¥—Ä—É–≥–∏–µ |
| **–°–¥–µ–ª–∫–∏** | –ü–æ–ª–Ω—ã–π –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ |
| **Equity Curve** | –ì—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ |
| **JSON** | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö –±—ç–∫—Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è |
| **Markdown** | –ß–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–µ –æ—Ç—á—ë—Ç—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ |

## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç—á—ë—Ç**: –î–æ–±–∞–≤—å –≤ `BacktestReport`:
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ—Ä–≥—É–µ–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö (—Å–∏–º–≤–æ–ª—ã, —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã)
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –º–µ—Å—è—Ü–∞–º (–ø–æ–º–µ—Å—è—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å)
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—ç–∫—Ç–µ—Å—Ç–∞
   - –°–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (OS, –≤–µ—Ä—Å–∏—è Rust)

2. **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç**: –°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é `compare_reports`:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç 2-5 –æ—Ç—á—ë—Ç–æ–≤ –æ –±—ç–∫—Ç–µ—Å—Ç–∞—Ö
   - –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
   - –í—ã–¥–µ–ª—è–µ—Ç –ª—É—á—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é, –∫–∞–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã–±—Ä–∞—Ç—å
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Markdown —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

3. **HTML Dashboard**: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å:
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π equity curve (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å plotly –∏–ª–∏ Chart.js)
   - –¢–∞–±–ª–∏—Ü–∞–º–∏ –º–µ—Ç—Ä–∏–∫
   - –°–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø—Ä–∏–±—ã–ª—å–Ω—ã–º/—É–±—ã—Ç–æ—á–Ω—ã–º —Å–¥–µ–ª–∫–∞–º
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –ø—Ä–æ—Å–∞–¥–∫–∏

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤**: –†–µ–∞–ª–∏–∑—É–π —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –±—ç–∫—Ç–µ—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–π –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç –≤ Telegram/Slack
   - –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å Sharpe > 2.0 ‚Äî —Å—Ä–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ GitHub issue –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —Ç–µ—Å—Ç–∞

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

[‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å](../294-overfitting-strategy-optimization/ru.md) | [–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí](../304-project-backtesting-engine/ru.md)
